# 🧪 Chatbot UI 完整测试指南

**测试时间**: 2026-01-21
**服务状态**: ✅ 前端和后端都已启动

---

## 🚀 服务运行状态

### ✅ 前端服务
- **地址**: http://localhost:3000
- **状态**: 🟢 运行中
- **进程**: 54365
- **技术**: Vue 3 + Vite

### ✅ 后端服务
- **地址**: http://localhost:8080
- **状态**: 🟢 运行中
- **进程**: 63911
- **技术**: Spring Boot 3.5.0
- **健康检查**: ✅ UP

---

## 📋 快速测试清单

### 第 1 步: 访问前端

1. **打开浏览器**: http://localhost:3000

2. **检查控制台** (F12):
   - [ ] 无 JavaScript 错误
   - [ ] 无网络请求失败
   - [ ] API 请求指向 http://localhost:8080

---

### 第 2 步: 登录系统

**测试账号** (需要先创建):
```
用户名: admin
密码: admin123
```

如果没有账号，需要先注册:
- 点击"注册"链接
- 填写注册信息
- 提交表单

**预期结果**:
- [ ] 登录成功后重定向到 Dashboard
- [ ] 显示导航菜单
- [ ] 显示"聊天机器人"菜单项

---

### 第 3 步: Chatbot 列表测试

#### TC-1: 查看列表页面
1. 点击"聊天机器人"菜单
2. 检查页面显示

**预期**:
- [ ] 页面标题: "聊天机器人"
- [ ] 右上角显示"创建聊天机器人"按钮
- [ ] 表格包含以下列:
  - 头像
  - 名称
  - 绑定 Agent
  - 描述
  - 状态 (已发布/草稿)
  - 访问次数
  - 创建时间
  - 操作

#### TC-2: 创建聊天机器人
1. 点击"创建聊天机器人"按钮
2. 填写表单:
   - **名称**: "测试聊天机器人"
   - **描述**: "这是一个测试用的聊天机器人"
   - **绑定 Agent**: 选择一个 Agent (如果没有，需要先创建)
   - **欢迎语**: "你好！有什么可以帮助你的吗？"
   - **头像 URL**: 留空 (使用默认)
3. 点击"创建"按钮

**预期**:
- [ ] 显示"创建成功"消息
- [ ] 对话框自动关闭
- [ ] 新聊天机器人出现在列表中
- [ ] 头像显示名称首字母
- [ ] 状态显示为"草稿" (灰色标签)

#### TC-3: 表单验证测试
1. 再次点击"创建聊天机器人"
2. 不填写任何字段
3. 点击"创建"按钮

**预期**:
- [ ] "名称"字段下方显示错误: "请输入聊天机器人名称"
- [ ] "绑定 Agent"字段下方显示错误: "请选择 Agent"
- [ ] 对话框不关闭

---

### 第 4 步: Chatbot 详情测试

#### TC-4: 查看详情
1. 在列表中点击刚创建的聊天机器人的"查看"按钮

**预期**:
- [ ] 导航到详情页面
- [ ] URL 变为: `/chatbots/:id`
- [ ] 页面标题显示聊天机器人名称
- [ ] 左侧有返回按钮
- [ ] 右侧有"开始对话"按钮
- [ ] "信息"标签页显示:
  - 名称: 测试聊天机器人
  - 绑定 Agent: [选择的 Agent 名称]
  - 描述: 这是一个测试用的聊天机器人
  - 欢迎语: 你好！有什么可以帮助你的吗？
  - 状态: 草稿 (灰色标签)
  - 访问次数: 0
  - 创建时间: [日期时间]
  - 更新时间: [日期时间]

#### TC-5: 编辑聊天机器人
1. 点击"编辑"按钮
2. 修改描述为: "更新后的描述"
3. 点击"保存"按钮

**预期**:
- [ ] 显示"更新成功"消息
- [ ] 对话框关闭
- [ ] 描述字段更新为新值

#### TC-6: 发布聊天机器人
1. 在"信息"标签页
2. 点击"发布"按钮

**预期**:
- [ ] 显示"发布成功"消息
- [ ] 状态标签变为"已发布" (绿色)
- [ ] "发布"按钮变为"取消发布"按钮 (黄色)

#### TC-7: 取消发布
1. 点击"取消发布"按钮

**预期**:
- [ ] 显示"已取消发布"消息
- [ ] 状态标签变为"草稿" (灰色)
- [ ] "取消发布"按钮变回"发布"按钮 (绿色)

#### TC-8: 查看对话历史
1. 点击"对话历史"标签页

**预期**:
- [ ] 表格显示对话列表 (如果有)
- [ ] 或显示空表格
- [ ] 显示"新建对话"按钮
- [ ] 表格包含列: 标题、创建时间、更新时间、操作

---

### 第 5 步: 聊天功能测试

#### TC-9: 开始对话
**方式 1**: 从详情页
1. 在详情页点击"开始对话"按钮

**方式 2**: 从列表页
1. 在列表页点击聊天机器人的"对话"按钮

**预期**:
- [ ] URL 变为: `/chatbots/:id?mode=chat`
- [ ] 页面切换到聊天模式
- [ ] 显示 ChatPanel 组件
- [ ] 底部显示输入框和"发送"按钮
- [ ] 如果有欢迎语，应该显示

#### TC-10: 发送消息 (Enter 键)
1. 在输入框输入: "你好"
2. 按 Enter 键发送

**预期**:
- [ ] 用户消息立即显示在聊天区域
- [ ] 用户消息在右侧，蓝色背景
- [ ] 显示用户头像或首字母
- [ ] 输入框清空
- [ ] AI 开始回复 (如果配置了 Agent)

#### TC-11: 多行输入 (Shift+Enter)
1. 在输入框输入: "第一行"
2. 按 Shift+Enter
3. 输入: "第二行"
4. 按 Enter 发送

**预期**:
- [ ] Shift+Enter 创建新行，不发送
- [ ] Enter 发送消息
- [ ] 发送的消息包含两行

#### TC-12: 流式响应
如果 Agent 配置正确，发送需要 AI 回复的消息:

1. 发送: "介绍一下你自己"

**预期**:
- [ ] AI 回复显示在左侧，白色背景
- [ ] 显示聊天机器人名称
- [ ] 消息逐字/逐句出现 (流式效果)
- [ ] 末尾显示闪烁光标 "|"
- [ ] 响应完成后光标消失
- [ ] Markdown 正确渲染 (如果有代码块、列表等)

#### TC-13: Markdown 渲染测试
发送消息让 AI 返回 Markdown 格式:
1. 发送: "写一个 Python Hello World 程序"

**预期**:
- [ ] 代码块显示语法高亮
- [ ] 代码块有深色背景
- [ ] 代码可读性好

#### TC-14: 对话历史
1. 在聊天页面，点击返回按钮
2. 进入"对话历史"标签页
3. 点击刚创建的对话

**预期**:
- [ ] 加载历史消息
- [ ] 所有消息按时间显示
- [ ] 可以继续对话

#### TC-15: 自动滚动测试
1. 发送多条消息
2. 或发送一个会触发长回复的消息

**预期**:
- [ ] 聊天区域自动滚动到底部
- [ ] 最新消息始终可见
- [ ] 流式响应时持续跟随

---

### 第 6 步: 删除测试

#### TC-16: 删除聊天机器人
**警告**: 这会永久删除测试数据

1. 在列表页找到测试聊天机器人
2. 点击"删除"按钮
3. 在确认对话框点击"确定"

**预期**:
- [ ] 显示确认对话框: "确定要删除聊天机器人"<名称>"吗？"
- [ ] 点击"确定"后显示"删除成功"消息
- [ ] 聊天机器人从列表中移除

---

## 🔍 调试技巧

### 检查网络请求
1. 打开浏览器开发者工具 (F12)
2. 切换到"Network"标签
3. 执行操作 (如创建聊天机器人)
4. 检查请求:
   - Request URL: http://localhost:8080/api/...
   - Request Method: POST/GET/PUT/DELETE
   - Status Code: 200 (成功) 或 4xx/5xx (错误)
   - Response: 查看 JSON 响应

### 常见问题排查

#### 问题 1: 无法连接后端
**症状**: Network request failed
**检查**:
1. 确认后端运行: `lsof -i :8080`
2. 检查前端 API 配置: `frontend/.env.development`
3. 查看后端日志: `tail -f /tmp/backend.log`

#### 问题 2: 登录失败
**检查**:
1. 确认用户已创建
2. 查看后端日志中的认证错误
3. 检查密码是否正确

#### 问题 3: SSE 流式响应不工作
**检查**:
1. 查看浏览器 Network 标签，查找 EventSource 连接
2. 检查后端是否支持 SSE
3. 查看是否有 CORS 错误

#### 问题 4: 消息不显示
**检查**:
1. 打开控制台查看 JavaScript 错误
2. 检查消息数据结构
3. 查看是否有渲染错误

---

## 📊 测试结果记录

### 通过的测试
- [ ] TC-1: 查看列表页面
- [ ] TC-2: 创建聊天机器人
- [ ] TC-3: 表单验证
- [ ] TC-4: 查看详情
- [ ] TC-5: 编辑聊天机器人
- [ ] TC-6: 发布聊天机器人
- [ ] TC-7: 取消发布
- [ ] TC-8: 查看对话历史
- [ ] TC-9: 开始对话
- [ ] TC-10: 发送消息
- [ ] TC-11: 多行输入
- [ ] TC-12: 流式响应
- [ ] TC-13: Markdown 渲染
- [ ] TC-14: 对话历史
- [ ] TC-15: 自动滚动
- [ ] TC-16: 删除聊天机器人

### 发现的问题
1. _________________
2. _________________
3. _________________

### 截图保存位置
建议保存测试截图到: `docs/screenshots/chatbot-ui/`

---

## 🎯 测试完成标准

### 最小可行 (MVP)
- ✅ 可以创建聊天机器人
- ✅ 可以查看和编辑聊天机器人
- ✅ 可以发送和接收消息
- ✅ 基本功能无错误

### 完整功能
- ✅ 所有测试用例通过
- ✅ 流式响应正常工作
- ✅ Markdown 渲染正确
- ✅ 对话历史完整
- ✅ 错误处理友好

---

## 📝 测试笔记

```
在测试过程中记录发现的问题、改进建议等...
```

---

**测试开始时间**: _________________
**测试完成时间**: _________________
**测试人员**: _________________
**测试结果**: ☐ 通过 ☐ 需要修复

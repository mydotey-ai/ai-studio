# Chatbot UI 测试计划

**测试日期**: 2026-01-21
**测试范围**: 聊天机器人 UI (Task 5-8)
**测试类型**: 端到端功能测试

---

## 测试环境准备

### 前置条件
- [x] 前端代码已构建成功
- [ ] 后端服务运行中 (http://localhost:8080)
- [ ] 数据库已初始化
- [ ] 测试用户已创建
- [ ] 测试 Agent 已创建
- [ ] 测试知识库已创建 (可选)

### 启动服务
```bash
# 后端 (在项目根目录)
./mvnw spring-boot:run

# 前端开发服务器
cd frontend
npm run dev
```

访问: http://localhost:5173

---

## 测试用例

### 模块 1: Chatbot 列表视图 (Task 6)

#### TC-1.1: 查看聊天机器人列表
**步骤**:
1. 登录系统
2. 导航到"聊天机器人"页面

**预期结果**:
- [ ] 页面标题显示"聊天机器人"
- [ ] 显示"创建聊天机器人"按钮
- [ ] 表格显示所有聊天机器人（如果有）
- [ ] 表格包含列: 头像、名称、绑定 Agent、描述、状态、访问次数、创建时间、操作
- [ ] 分页控件显示在底部

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-1.2: 创建聊天机器人 (成功)
**步骤**:
1. 点击"创建聊天机器人"按钮
2. 填写表单:
   - 名称: "测试聊天机器人"
   - 描述: "这是一个测试聊天机器人"
   - 绑定 Agent: 选择一个 Agent
   - 欢迎语: "你好！有什么可以帮助你的吗？"
   - 头像 URL: 留空或输入 URL
3. 点击"创建"按钮

**预期结果**:
- [ ] 表单验证通过
- [ ] 显示"创建成功"消息
- [ ] 对话框关闭
- [ ] 表单重置
- [ ] 新聊天机器人出现在列表中
- [ ] 新聊天机器人显示正确的头像 (名称首字母)
- [ ] 状态显示为"草稿"

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-1.3: 创建聊天机器人 (表单验证)
**步骤**:
1. 点击"创建聊天机器人"按钮
2. 不填写任何字段
3. 点击"创建"按钮

**预期结果**:
- [ ] 显示验证错误消息
- [ ] "名称"字段显示"请输入聊天机器人名称"
- [ ] "绑定 Agent"字段显示"请选择 Agent"
- [ ] 对话框不关闭

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-1.4: 查看聊天机器人详情
**步骤**:
1. 在列表中点击一个聊天机器人的"查看"按钮
2. 或点击表格行

**预期结果**:
- [ ] 导航到详情页面
- [ ] 页面标题显示聊天机器人名称
- [ ] 返回按钮可用
- [ ] "开始对话"按钮可见
- [ ] "信息"标签页显示:
  - 名称
  - 绑定 Agent
  - 描述
  - 欢迎语
  - 状态 (已发布/草稿)
  - 访问次数
  - 创建时间
  - 更新时间
- [ ] "对话历史"标签页显示历史对话列表

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-1.5: 删除聊天机器人
**步骤**:
1. 在列表中点击一个聊天机器人的"删除"按钮
2. 在确认对话框中点击"确定"

**预期结果**:
- [ ] 显示确认对话框: "确定要删除聊天机器人"<名称>"吗？"
- [ ] 点击"确定"后显示"删除成功"消息
- [ ] 聊天机器人从列表中移除

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

### 模块 2: Chatbot 详情视图 (Task 7)

#### TC-2.1: 编辑聊天机器人
**步骤**:
1. 打开聊天机器人详情页面
2. 点击"编辑"按钮
3. 修改字段:
   - 名称: "更新后的名称"
   - 描述: "更新后的描述"
4. 点击"保存"按钮

**预期结果**:
- [ ] 编辑对话框打开
- [ ] 对话框标题: "编辑聊天机器人"
- [ ] 字段预填充当前值
- [ ] 保存后显示"更新成功"消息
- [ ] 对话框关闭
- [ ] 详情信息更新

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-2.2: 发布聊天机器人
**步骤**:
1. 打开一个草稿状态的聊天机器人详情
2. 点击"发布"按钮

**预期结果**:
- [ ] 显示"发布成功"消息
- [ ] 状态标签变为"已发布" (绿色)
- [ ] "发布"按钮变为"取消发布"按钮 (黄色)

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-2.3: 取消发布聊天机器人
**步骤**:
1. 打开一个已发布状态的聊天机器人详情
2. 点击"取消发布"按钮

**预期结果**:
- [ ] 显示"已取消发布"消息
- [ ] 状态标签变为"草稿" (灰色)
- [ ] "取消发布"按钮变为"发布"按钮 (绿色)

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

### 模块 3: Chat Panel 和聊天界面 (Task 7)

#### TC-3.1: 开始对话
**步骤**:
1. 打开聊天机器人详情页面
2. 点击"开始对话"按钮
3. 或在列表中点击"对话"按钮

**预期结果**:
- [ ] URL 变为 `/chatbots/:id?mode=chat`
- [ ] 页面切换到聊天模式
- [ ] ChatPanel 组件显示
- [ ] 输入框可用
- [ ] 发送按钮可用
- [ ] 显示欢迎语 (如果有)

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.2: 发送消息 (Enter 键)
**步骤**:
1. 在聊天界面
2. 输入消息: "你好"
3. 按 Enter 键

**预期结果**:
- [ ] 用户消息立即显示在聊天区域
- [ ] 用户消息显示在右侧 (蓝色背景)
- [ ] 显示用户头像或首字母
- [ ] 显示时间戳
- [ ] 输入框清空
- [ ] 助手开始回复 (如果有后端连接)

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.3: 发送消息 (Shift+Enter)
**步骤**:
1. 在聊天界面
2. 输入第一行消息
3. 按 Shift+Enter
4. 输入第二行消息
5. 按 Enter 发送

**预期结果**:
- [ ] Shift+Enter 创建新行,不发送消息
- [ ] Enter 发送消息
- [ ] 发送的消息包含多行文本

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.4: 流式响应显示
**步骤**:
1. 发送一条需要 AI 回复的消息
2. 观察 AI 回复过程

**预期结果**:
- [ ] AI 消息显示在左侧 (白色背景)
- [ ] 显示聊天机器人头像
- [ ] 显示聊天机器人名称
- [ ] 消息逐字/逐句出现 (流式)
- [ ] 末尾显示闪烁光标 "|"
- [ ] 响应完成后光标消失
- [ ] 消息内容支持 Markdown (代码高亮、列表等)

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.5: Markdown 渲染
**步骤**:
1. 发送消息让 AI 返回包含 Markdown 的内容
2. 或使用已知的 Markdown 响应

**预期结果**:
- [ ] 代码块显示语法高亮
- [ ] 标题 (h1, h2, h3) 正确渲染
- [ ] 列表 (有序/无序) 正确渲染
- [ ] 链接可点击
- [ ] 粗体/斜体正确显示

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.6: 来源引用显示 (如果支持)
**步骤**:
1. 发送可能触发知识库检索的消息
2. 观察 AI 回复

**预期结果**:
- [ ] 如果有来源,显示"参考来源:"标题
- [ ] 来源可折叠/展开
- [ ] 每个来源显示:
  - 文档名称
  - 页码 (chunkIndex)
  - 内容片段
  - 相似度百分比

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败 (如不支持可跳过)

---

#### TC-3.7: 工具调用显示 (如果支持)
**步骤**:
1. 发送可能触发工具调用的消息
2. 观察 AI 回复

**预期结果**:
- [ ] 如果有工具调用,显示"工具调用:"标题
- [ ] 时间线显示每个工具调用
- [ ] 每个调用显示:
  - 工具名称
  - 参数 (JSON 格式)
  - 执行结果或错误信息

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败 (如不支持可跳过)

---

#### TC-3.8: 自动滚动
**步骤**:
1. 发送多条消息
2. 或接收长回复

**预期结果**:
- [ ] 聊天区域自动滚动到底部
- [ ] 最新消息始终可见
- [ ] 流式响应时持续跟随

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-3.9: 禁用状态 (流式响应中)
**步骤**:
1. 发送消息
2. 在 AI 回复期间尝试发送另一条消息

**预期结果**:
- [ ] 发送按钮显示加载状态
- [ ] 输入框禁用
- [ ] 发送按钮禁用
- [ ] 无法发送新消息直到当前回复完成

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

### 模块 4: 对话历史管理 (Task 7)

#### TC-4.1: 查看对话历史列表
**步骤**:
1. 打开聊天机器人详情页面
2. 点击"对话历史"标签页

**预期结果**:
- [ ] 表格显示所有对话
- [ ] 表格包含列: 标题、创建时间、更新时间、操作
- [ ] 如果没有对话,表格为空
- [ ] 显示"新建对话"按钮
- [ ] 分页控件显示

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-4.2: 创建新对话
**步骤**:
1. 在"对话历史"标签页
2. 点击"新建对话"按钮

**预期结果**:
- [ ] 显示"对话创建成功"消息
- [ ] 新对话出现在列表中
- [ ] 新对话标题显示为"新对话"

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-4.3: 加载对话消息
**步骤**:
1. 在"对话历史"标签页
2. 点击一个对话行

**预期结果**:
- [ ] 切换到聊天模式
- [ ] 加载该对话的历史消息
- [ ] 所有消息按时间顺序显示
- [ ] 可以继续该对话

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-4.4: 删除对话
**步骤**:
1. 在"对话历史"标签页
2. 点击一个对话的"删除"按钮
3. 在确认对话框中点击"确定"

**预期结果**:
- [ ] 显示确认对话框
- [ ] 点击"确定"后显示"删除成功"消息
- [ ] 对话从列表中移除

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

### 模块 5: 集成测试

#### TC-5.1: 完整对话流程
**步骤**:
1. 创建新的聊天机器人
2. 绑定到一个 Agent
3. 发布聊天机器人
4. 开始对话
5. 发送多条消息
6. 返回详情页
7. 查看对话历史

**预期结果**:
- [ ] 所有步骤成功完成
- [ ] 消息正确保存
- [ ] 对话历史完整
- [ ] 访问次数增加

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-5.2: 错误处理
**步骤**:
1. 在后端服务关闭的情况下
2. 尝试创建聊天机器人
3. 尝试发送消息

**预期结果**:
- [ ] 创建操作显示错误消息
- [ ] 聊天操作显示"发送失败"消息
- [ ] UI 不崩溃
- [ ] 可以重试操作

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

#### TC-5.3: 导航测试
**步骤**:
1. 从列表 → 详情 → 聊天 → 返回 → 列表
2. 使用浏览器后退/前进按钮

**预期结果**:
- [ ] 所有导航流畅
- [ ] URL 正确更新
- [ ] 页面状态正确恢复
- [ ] 没有控制台错误

**实际结果**: _________________

**状态**: ☐ 通过 ☐ 失败

---

## 测试数据

### 测试 Chatbot
```
名称: 测试聊天机器人
描述: 这是一个用于测试的聊天机器人
欢迎语: 你好！我是测试助手，有什么可以帮助你的吗？
头像: (留空,使用默认)
Agent: (选择一个已创建的 Agent)
```

### 测试消息
```
1. "你好" - 测试基本问候
2. "介绍一下你自己" - 测试自我认知
3. "1+1等于几？" - 测试简单问答
4. "写一个 Python 函数" - 测试 Markdown 代码渲染
5. "总结一下我们的对话" - 测试多轮对话记忆
```

---

## 已知限制和备注

### 不需要测试的功能
- MCP 工具集成 (未实现)
- 知识库检索 (未实现)
- 高级设置 (温度、Token 限制等 - 已从 UI 移除)

### 后端依赖
- 某些测试需要后端 API 正常运行
- 如果后端不可用,某些测试会失败

### 浏览器兼容性
- 主要测试: Chrome/Edge (最新版本)
- 次要测试: Firefox, Safari (如果有时间)

---

## 测试结果汇总

### 通过/失败统计
- 总测试用例: __
- 通过: __
- 失败: __
- 跳过: __
- 通过率: __%

### 按模块统计
- 模块 1 (列表视图): __/__ 通过
- 模块 2 (详情视图): __/__ 通过
- 模块 3 (聊天界面): __/__ 通过
- 模块 4 (对话历史): __/__ 通过
- 模块 5 (集成测试): __/__ 通过

### 发现的问题
1. _________________
2. _________________
3. _________________

### 建议改进
1. _________________
2. _________________
3. _________________

---

## 测试签名

**测试人员**: _________________
**测试日期**: _________________
**审核人员**: _________________
**审核日期**: _________________
